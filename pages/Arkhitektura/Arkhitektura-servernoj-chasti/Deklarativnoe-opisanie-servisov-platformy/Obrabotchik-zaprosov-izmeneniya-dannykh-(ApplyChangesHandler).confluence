---
layout: default
title: Обработчик запросов изменения данных (ApplyChangesHandler)
position: 
categories: 
tags: 
---

<p>Обработчик предназначен для применения изменений к объекту с указанным идентификатором.</p><p>Для понимания принципа работы необходимо ознакомиться с основными положениями, лежащими в основе работы платформы. <span class="confluence-link"><ac:link><ri:page ri:content-title="Запрос на создание (модификацию) объекта" ri:space-key="MCP" /><ac:plain-text-link-body><![CDATA[Подробнее]]></ac:plain-text-link-body></ac:link></span></p><p>Рассмотрим подробнее последовательность работы обработчика</p><table><tbody><tr><th>№п/п</th><th>Действие</th><th colspan="1">Тип действия</th><th>Цель</th></tr><tr><td>1</td><td>Заполнение контекста обработки входящего запроса данных</td><td colspan="1">Логика обработчика</td><td>Заполнить контекст вызова прикладного скрипта объектами-помощниками (помощники получения и изменения данных и метаданных конфигурации)</td></tr><tr><td colspan="1">2</td><td colspan="1">Заполнение контекста обработчика данными о роутинге, полученными из урла запроса</td><td colspan="1">Логика обработчика</td><td colspan="1">Установить идентификатор конфигурации и объекта метаданных в контексте которых выполняется запрос (для использования прикладным разработчиком в случае необходимости</td></tr><tr><td class="highlight-green" colspan="1" data-highlight-colour="green">3</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Фильтрация входящих событий формирования изменений объекта</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Логика пользовательской точки расширения</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Отфильтровать вредные/опасные события из входящего запроса</td></tr><tr><td colspan="1">4</td><td colspan="1">Получение агрегата из хранилища по указанному идентификатору</td><td colspan="1">Логика обработчика</td><td colspan="1">Получить существующий агрегат из хранилища. Если агрегат с указанным идентификатором найден - возвращается найденный. Если не найден - создается новый агрегат с указанным идентификатором.</td></tr><tr><td colspan="1">5</td><td colspan="1">Сохранение событий в первичном хранилище для backup</td><td colspan="1">Логика обработчика</td><td colspan="1">Сохраняем агрегат в Cassandra</td></tr><tr><td colspan="1">6</td><td colspan="1">Применение событий изменения объекта к агрегату из хранилища</td><td colspan="1">Логика обработчика</td><td colspan="1">Получить измененный агрегат</td></tr><tr><td class="highlight-green" colspan="1" data-highlight-colour="green">7</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Перевод объекта из состояния в состояние</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Логика пользовательской точки расширения</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Выполнить перевод объекта из исходного состояния (например, &quot;Temporary&quot;) в конечное (например, &quot;Saved&quot;). Действие, выполняемое при переходе объекта из одного состояния в другое, задается декларативно.</td></tr><tr><td class="highlight-green" colspan="1" data-highlight-colour="green">8</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Формирование результата применения изменений</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Логика пользовательской точки расширения</td><td class="highlight-green" colspan="1" data-highlight-colour="green">Проанализировать результат перевода объекта из состояния в состояние и сформировать результат для отправки пользователю</td></tr><tr><td colspan="1">9</td><td colspan="1">Отправка результата применения изменений пользователю</td><td colspan="1">Логика обработчика</td><td colspan="1">Отправить результат обработки</td></tr></tbody></table><p>Выделенные зеленым точки являются точками вызова прикладных скриптов, разрабатываемых прикладным программистом. Подробнее о точках расширения см.<ac:link><ri:page ri:content-title="Точки расширения бизнес-логики" /><ac:plain-text-link-body><![CDATA[здесь]]></ac:plain-text-link-body></ac:link>.</p>