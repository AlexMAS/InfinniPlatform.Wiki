---
layout: default
title: Конфигурация ClassifierLoader
position: 
categories: 
tags: 
---

<p>Конфигурация позволяет загружать содержимое справочников из различных источников в хранилище справочников (в ходе загрузки данные помещаются в ClassifierStorage).</p><p>В рамках конфигурации реализована загрузка справочников из следующих источников:</p><ul><li>Сервис НСИ Росминздрава (<a href="http://nsi.rosminzdrav.ru/wsdl/SOAP-server.v2.php">http://nsi.rosminzdrav.ru/wsdl/SOAP-server.v2.php</a>)</li><li>Справочники в формате DBF</li><li>Справочники в формате Microsoft Excel</li></ul><p><span style="background-color: transparent;line-height: 1.4285715;">Зарегистрированные сервисы конфигурации:</span></p><ul><li><p>Сервис ApplyEvents позволяет импортировать один справочник. При запросе необходимо указывать источник данных для импорта через параметр ImportSource. Справочник будет успешно импортирован, только если в хранилище справочников нет более свежей версии справочника. &nbsp;<br />Параметры:</p><table><tbody><tr><th><div class="tablesorter-header-inner">Имя параметра</div></th><th><div class="tablesorter-header-inner">Назначение</div></th><th colspan="1"><div class="tablesorter-header-inner">Обязательность</div></th><th><div class="tablesorter-header-inner">Пример значения</div></th></tr><tr><td colspan="1">ImportSource</td><td colspan="1">&nbsp;Источник данных для импорта&nbsp;</td><td colspan="1">Да</td><td colspan="1">&quot;Federal&quot;, &quot;Excel&quot; или &quot;Dbf</td></tr><tr><td>ClassifierIds</td><td>Список уникальных идентификаторов справочников (коллекция строк)</td><td colspan="1">Да (если параметру ImportSource установлено значение &quot;Federal&quot;)</td><td><p>[<br /> &quot;oid_1_2_643_5_1_13_2_1_1_145&quot;,<br /> &quot;oid_1_2_643_5_1_13_2_1_1_654&quot;</p><p>]</p></td></tr><tr><td>Overwrite</td><td>Флаг, позволяющий перезаписать данные справочника, в том случае, если загружаемая версия справочника была импортирована ранее.</td><td colspan="1">Нет (значение по умолчанию - false)</td><td>true</td></tr><tr><td colspan="1"><span>ClassifierContent</span></td><td colspan="1"><span>Содержимое dbf или xls файла в формате Base64String</span></td><td colspan="1"><span>Да (если параметру ImportSource установлено значение &quot;<span>Excel</span>&quot;, &quot;Xml&quot; или &quot;Dbf&quot;)</span></td><td colspan="1">&nbsp;</td></tr><tr><td colspan="1"><span>ClassifierMetadata</span></td><td colspan="1"><span>Содержимое xml файла с метаданными справочника в формате </span><span>Base64String</span></td><td colspan="1"><span>Да </span><span>&nbsp;</span><span>(если параметру ImportSource установлено значение <span>&quot;</span><span>Excel</span><span>&quot;<span>, &quot;Xml&quot;</span> или &quot;Dbf&quot;</span>)</span></td><td colspan="1">&nbsp;</td></tr><tr><td colspan="1"><span>ClassifierCodePage</span></td><td colspan="1"><span>Номер кодовой страницы для содержимого dbf файла. Заполнение параметра необходимодля &quot;старых&quot; dbf файлов из ФОМС, закодированных, например, с использованием кодовой страницы 866.</span></td><td colspan="1">Нет (по умолчанию используется кодовая страница 1251)</td><td colspan="1">866</td></tr><tr><td colspan="1">RootTag</td><td colspan="1">Наименование xml тега, содержащего полезные данные об одной записи справочника</td><td colspan="1"><span>Нет. По умолчанию используется тег &quot;zap&quot;, наиболее часто встречающийся в xml справочниках Минздрава. Параметр </span><span>указывается, только если ImportSource установлено значение &quot;Xml&quot;)</span></td><td colspan="1">&quot;insCompany&quot;</td></tr></tbody></table><p><br />Примечание: использование параметра&nbsp;<span>Overwrite&nbsp;</span><span>позволяет произвести повторную загрузку справочника в случае, если в ходе загрузки произошли сбой. Например, если в ходе загрузки справочника&nbsp;oid_1_2_643_5_1_13_2_1_1_56<span style="color: rgb(0,0,0);">&nbsp;версии 1.1 перестал отвечать SOAP сервис и загрузка прервалась, мы можем повторить загрузку через некоторое время. В этом случае нужно обязательно указать&nbsp;<span>Overwrite &nbsp;true</span><span>&nbsp;в запросе, поскольку в противном случае загрузка производиться не будет (так как версия справочника 1.1 уже имеется).</span></span></span></p><p><span style="color: rgb(0,0,0);background-color: transparent;line-height: 1.4285715;">&nbsp;</span></p><p>Пример метаданных справочника в формате xml (метаданные передаются при импорте справочников из Excel<span>, Xml</span>&nbsp;или DBF файлов):</p><p><span><span style="color: rgb(0,0,0);">&nbsp;</span></span><span style="background-color: transparent;line-height: 1.4285715;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></p><p>&lt;classifier&gt;<br />&nbsp; &nbsp;&lt;properties&gt;<br />&nbsp; &nbsp; &nbsp; &lt;CodeSystem&gt;oid_1_2_643_5_1_13_2_1_1_56&lt;/CodeSystem&gt;<br />&nbsp; &nbsp; &nbsp; &lt;CodeSystemVersion&gt;1.0&lt;/CodeSystemVersion&gt;<br />&nbsp; &nbsp; &nbsp; &lt;CodeSystemName&gt;Анатомо-терапевтическо-химическая классификация&lt;/CodeSystemName&gt;<br />&nbsp; &nbsp; &nbsp; &lt;CodeRef&gt;code&lt;/CodeRef&gt;<br />&nbsp; &nbsp; &nbsp; &lt;IdRef&gt;recid&lt;/IdRef&gt;<br />&nbsp; &nbsp; &nbsp; &lt;DisplayNameRef&gt;name&lt;/DisplayNameRef&gt;<br />&nbsp; &nbsp; &nbsp; &lt;ParentRef&gt;high&lt;/ParentRef&gt;<br />&nbsp; &nbsp; &nbsp; &lt;Description&gt;Международная система классификации лекарственных средств по их основному терапевтическому применению&lt;/Description&gt;<br />&nbsp; &nbsp;&lt;/properties&gt;<br />&nbsp; &nbsp;&lt;entries&gt;&nbsp;<br />&nbsp; &nbsp; &nbsp; &lt;entry name=&quot;recid&quot; caption=&quot;Уникальный идентификатор&quot; type=&quot;int&quot; description=&quot;&quot;/&gt;<br />&nbsp; &nbsp; &nbsp; &lt;entry name=&quot;code&quot; caption=&quot;Код записи&quot; type=&quot;string&quot; description=&quot;&quot;/&gt;<br />&nbsp; &nbsp; &nbsp; &lt;entry name=&quot;name&quot; caption=&quot;Название лекарственного средства&quot; type=&quot;string&quot; description=&quot;&quot;/&gt;<br />&nbsp; &nbsp; &nbsp; &lt;entry name=&quot;latname&quot; caption=&quot;Латинское название лекарственного средства&quot; type=&quot;string&quot; description=&quot;&quot;/&gt;<br />&nbsp; &nbsp; &nbsp; &lt;entry name=&quot;num&quot; caption=&quot;NUM&quot; type=&quot;string&quot; description=&quot;&quot;/&gt;<br />&nbsp; &nbsp; &nbsp; &lt;entry name=&quot;high&quot; caption=&quot;УИ родительской записи&quot; type=&quot;int&quot; description=&quot;&quot;/&gt;<br />&nbsp; &nbsp;&lt;/entries&gt;<br />&lt;/classifier&gt;</p><p><span><span style="color: rgb(0,0,0);"><span><br /></span></span></span></p></li></ul><ul><li><p>Сервис Search позволяет получить список федеральных справочников, доступных на сервисе. Формат отправки запроса к сервису:</p><p>GET</p><p><span class="nolink">http://&lt;ServerName&gt;:&lt;PortName&gt;/ClassifierLoader/StandardApi/classifiers/search/?query= {&quot;FilterObject&quot;:null,&quot;PageNumber&quot;:0,&quot;PageSize&quot;:1000,&quot;SearchType&quot;:1,&quot;Version&quot;:null}</span></p><p>В качестве ответа на запрос приходит JSON массив с информацией об доступных для импорта справочниках Росминздрава (федеральные справочники). Пример возвращаемого значения:</p><p style="margin-left: 30.0px;">[{<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Oid&quot;: &quot;oid_1_2_643_5_1_13_2_1_1_587&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Description&quot;: &quot;&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Id&quot;: &quot;587&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Name&quot;: &quot;Государственный реестр лекарственных средств&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Code&quot;: &quot;GRL365&quot;<br />},<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp;&quot;Oid&quot;: &quot;oid_1_2_643_5_1_13_2_1_1_644&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp;&quot;Description&quot;: &quot;&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp;&quot;Id&quot;: &quot;644&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp;&quot;Name&quot;: &quot;Действующие вещества лекарственных препаратов&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp;&quot;Code&quot;: &quot;DVL105&quot;<br />}]</p></li></ul><p>&nbsp;</p><div><strong>Примеры запросов для загрузки справочников из различных источников</strong></div><div><ol><li>Загрузка из федерального сервиса Росминздрава:<br /><p style="margin-left: 30.0px;">POST</p><p style="margin-left: 30.0px;"><span class="nolink"><a href="http://10.10.1.223:9999/ClassifierLoader/StandardApi/classifiers/Publish">http://10.10.1.223:9999/ClassifierLoader/StandardApi/classifiers/Publish</a></span>&nbsp;</p><p style="margin-left: 30.0px;">Тело запроса:</p><p style="margin-left: 30.0px;">{<br />&nbsp;&nbsp;&nbsp;&quot;id&quot;: null,<br />&nbsp;&nbsp;&nbsp;&quot;changesObject&quot;:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;ClassifierIds&quot;: [<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;oid_1_2_643_5_1_13_2_1_1_654&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;oid_1_2_643_5_1_13_2_1_1_587&quot;],<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ImportSource&quot;: &quot;Federal&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Overwrite&quot;: true<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="margin-left: 30.0px;">}</p></li><li>Загрузка из локального Excel файла:<br /><p>POST</p><p><span class="nolink"><a href="http://10.10.1.223:9999/ClassifierLoader/StandardApi/classifiers/Publish">http://10.10.1.223:9999/ClassifierLoader/StandardApi/classifiers/Publish</a></span>&nbsp;</p><p>Тело запроса:</p><p>{</p><p style="margin-left: 30.0px;">&nbsp; &nbsp;&quot;id&quot;: null,<br />&nbsp;&nbsp;&nbsp;&quot;changesObject&quot;:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ClassifierMetadata&quot;: &quot;PD94bWwgdmVyc2l...&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ClassifierContent&quot;: &quot;0M8R4KGxGuEAAAAA...&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ImportSource&quot;:&nbsp;&quot;Excel&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp;&nbsp;&nbsp;]<br />}</p></li><li>Загрузка из локального DBF файла:<br /><p>POST</p><p><span class="nolink"><a href="http://10.10.1.223:9999/ClassifierLoader/StandardApi/classifiers/Publish">http://10.10.1.223:9999/ClassifierLoader/StandardApi/classifiers/Publish</a></span>&nbsp;</p><p>Тело запроса:</p><p>{</p><p style="margin-left: 30.0px;">&nbsp; &nbsp;&quot;id&quot;: null,<br />&nbsp;&nbsp;&nbsp;&quot;changesObject&quot;:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ClassifierMetadata&quot;: &quot;PD94bWwgdmVyc2l...&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ClassifierContent&quot;: &quot;0M8R4KGxGuEAAAAA...&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ImportSource&quot;:&nbsp;&quot;Dbf&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp;&nbsp;&nbsp;]<br />}</p><p><br />Таким образом, при загрузке из различных источников меняется только тело запроса (URL запроса остается неизменным).</p></li></ol></div>