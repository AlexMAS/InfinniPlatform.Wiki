---
layout: default
title: "Особенности развертывания конфигурации PR на сервере"
position: 5
categories: 
tags: 
---

В данному разделе перечислены дополнительные шаги, которые необходимо выполнить при развертывании конфигурации PregnantRegister на сервере. Для развертывания службе техподдержки будет предоставлен архив с конфигурацией PR.zip. Архив содержит все командные файлы и утилиты, необходимые для разворачивания конфигурации.

После того, как установлена и запущена платформа (обратить внимание на запуск командного файла InstallPlatform.cmd), запускаем файл UploadWithMetadata.cmd. Дожидаемся окончания загрузки конфигурации.Запускаем файл ImportData для импорта всех справочников (процесс может занимать длительное время).Заходим через UI в конфигурацию под логином Admin с паролем Admin. Заходим в меню "Администрирование -> Администратор -> Список организаций" и добавляем туда организации (ЛПУ, в которых будет использоваться конфигурация).Заходим в меню "Администрирование -> Администратор -> Роли" и добавляем три роли "Акушер-гинеколог женской консультации", "Акушер-гинеколог стационара" и "Локальный администратор"Заходим в меню "Администрирование -> Администратор -> Права на меню" и добавляем каждой роли доступ к своему пункту меню:  
"Акушер-гинеколог женской консультации" - меню из PregnantRegister с именем MainMenuForConsult  
"Акушер-гинеколог стационара" и  - меню из PregnantRegister с именем MainMenu  
"Локальный администратор" - меню из PregnantRegister с именем AdminMainMenuЧерез пункт "Администрирование -> Администратор -> Пользователи" добавляем локальных администратор (по одному на каждое ЛПУ, созданное на шаге 2). Каждому админу задаём логин и пароль, галочку "Администратор системы" не ставим. Указываем роль "Локальный администратор"После создания администратора организации необходимо связать его с организацией. В настоящее время сделать это можно через командный файл AddClaim.cmd. В этом файле нужно указать логин администратора, наименование организации. Например, чтобы связать администратора "admin_lpu_1" с ЛПУ "lpu_1", файл AddClaim.cmd должен содержать следующее: Utils.exe addclaim "admin_lpu_1" "lpu_1"Использовать для развертывания следующий коммит Медик+

|Changeset:|49101 (948f7a48bbc9) Merge|
|Branch:| f-pregnancyRegistry |
|Date:|2015-04-17 19:28:51 +0500|

Настраиваем Медик+ для интеграции с конфигурацией:  в UniOH\OH.Src\Web\Web\Web.config указываем 

```
  <pregnancyRegistryIntegration enable="true"    RESTApiUrl="http://<InfinniPlatformServerName>:<InfinniPlatformPortNumber>/RestfulApi/StandardApi/configuration" />
  
<!-- InfinniPlatform.Api config start -->
    <add key="AppServerName" value="<InfinniPlatformServerName>" />
    <add key="AppServerPort" value="<InfinniPlatformPortNumber>" />
    <add key="AppServerScheme" value="http"/>
    <add key="AppServerCertificate" value="490966d6df5b95b5456e7079a0bf969f43620534"/>
    <add key="AppServerProfileQuery" value="false"/>
 <!-- InfinniPlatform.Api config end -->
 
```

В AppServerName и AppServerPort тот же адрес и порт, что и в RESTApiUrl (имя сервера и номер порта дублируются дважды).

 

Особенность сборки UI части: вместо команды grunt build, необходимо выполнять grunt build:../PR/

