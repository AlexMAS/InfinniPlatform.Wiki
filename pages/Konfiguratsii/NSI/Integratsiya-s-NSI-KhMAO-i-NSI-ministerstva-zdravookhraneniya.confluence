---
layout: default
title: Интеграция с НСИ ХМАО и НСИ министерства здравоохранения
position: 
categories: 
tags: 
---

<h1>Описание основного бизнес-процесса</h1><p>&nbsp;В рамках сервиса НСИ предусмотрена интеграция с НСИ ХМАО и НСИ министерства здравоохранения.&nbsp;Интеграции с сервисом НСИ ХМАО и НСИ министерства здравоохранения &nbsp;предназначена для выполнения следующих функций:</p><ul><li>обновление справочников </li><li>добавление справочников </li></ul><p>&nbsp;Интеграция заключается в импорте новых справочников и импорте новых версий уже существующих в системе справочников</p><ul><li>с сервиса <a href="http://62.168.244.238:7001/MedvedWeb/Nsi?WSDL">http://62.168.244.238:7001/MedvedWeb/Nsi?WSDL</a><u> </u>для НСИ ХМАО</li><li>с сервиса <a href="http://nsi.rosminzdrav.ru/">http://nsi.rosminzdrav.ru</a> для НСИ системы здравоохранения</li></ul><p>В случае изменения, необходимо изменить путь к сервису и параметры авторизации в конфигурационном файле в формате xml отдельно для НСИ ХМАО и НСИ системы здравоохранения.</p><p>&nbsp;При импорте в НСИ создается новый справочник с уникальным идентификатором. Новый справочник создается и в случае импорта новой версии справочника. В этом случает новую версию справочника необходимо относить к определенной группе справочников с одинаковым уникальным идентификатором.&nbsp;</p><p>&nbsp;Наименование справочника, создаваемого в НСИ должно выглядеть следующим образом:&nbsp;&lt; CodeSystem &gt;_&lt; CodeSystemVersion &gt;</p><p>Где</p><p>CodeSystem &ndash; OID справочника (уникальный идентификатор справочника)</p><p>CodeSystemVersion &ndash; Версия справочника. Версию справочника необходимо указывать в формате А.В, где А и В &ndash; натуральные числа в диапазоне от 0 до 999, А - главный номер версии, В - вспомогательный номер версии. Главный номер версии изменяется в случае изменения структуры справочника. &nbsp;Например, &nbsp;&laquo;1.0&raquo;, &laquo;1.1&raquo; и т.д.</p><h1>Варианты использования</h1><h2>Интеграция с НСИ ХМАО</h2><p>Интеграция с НСИ министерства здравоохранения осуществляется посредством&nbsp; импорта новых справочников или новых версий уже имеющихся в реестре НСИ справочников посредством REST сервисов.</p><p>Для запуска импорта необходимо запустить соответствующую утилиту из командной строки:</p><ul><li>&gt;externalimport &ndash;source hmao &nbsp;- возвращает список всех имеющихся справочников</li><li>&gt;externalimport &ndash;source hmao OID1 OID2 &ndash; Добавляет новый справочник/версию справочника в реестр НСИ. Необходимо указать уникальный идентификатор импортируемого справочника или группы справочников. Для НСИ ХМАО подобным идентификатором выступает OID справочника.&nbsp;</li></ul><p>Например: &gt;externalimport &ndash;source hmao 1.2.643.5.1.13.2.1.1.169 (Классификатор причин возникновения инвалидности<strong>)</strong></p><p>За раз возможно импортировать не более 10 справочников.&nbsp;При импорте осуществляется сопоставление версий справочников. Если в реестре НСИ есть справочник&nbsp; с более поздней версией, импорт не производится.</p><p>В общем виде сервис интеграции с НСИ ХМАО выглядит следующим образом:</p><ol><li>Пользователь запрашивает с сервиса НСИ ХМАО полный перечень справочников</li><li>Пользователь видит перечень справочников</li><li>Задаются параметры импорта</li><li>Отправляется запрос сервису НСИ ХМАО на получение данных заданного справочника</li><li>Происходит добавление справочника в реестр НСИ</li><li>Пользователь получает информацию о результате выполнения импорта.</li></ol><p><strong style="line-height: 1.4285715;">Просмотр информации о результатах выполнения импорта</strong></p><p>Необходимо выводить в лог следующую информацию:</p><ul><li>о начале работы,</li><li>о завершении работы</li><li>о статусе завершения работы (с ошибками или нет).</li></ul><p><strong style="line-height: 1.4285715;">Обработка исключительных ситуаций:</strong></p><ul><li>&nbsp; &nbsp; &nbsp; &nbsp;Если программа не смогла распознать введенные параметры или параметры введены некорректно, то команда не выполняется.</li><li>&nbsp; &nbsp; &nbsp; &nbsp;Если невозможно к базе данных или невозможно найти в ней нужную таблицу, импорт не производится &nbsp;</li><li>&nbsp; &nbsp; &nbsp; &nbsp;В случае возникновения выше и иных ошибок, они выводятся в лог стандартным для системы способом.</li></ul><p>Интеграция с сервисом НСИ ХМАО реализуется посредством указанных ниже методов:</p><p><u>Отправка запроса на получения полного перечня справочников</u></p><p>Программа отправляет запрос getRefBookList() к веб-сервису:</p><p>Веб-сервис возвращает список справочников в виде массива структур вида:</p><p>s_code &ndash; уникальный код справочника,</p><p>s_name &ndash; наименование справочника,</p><p>s_version &ndash;текущая версия справочника</p><p><u style="line-height: 1.4285715;">Отображение перечня справочников, используемых в системе и требующих обновления</u></p><p>После получения полного списка справочников, программа обращается к регистру &laquo;Справочники&raquo;, устанавливает соответствие между данным списком и списком справочников, использующихся в системе, при этом сравнивая версию данных справочников.</p><p>В итоге пользователю в программе отображается таблица, которая содержит в себе информацию о:</p><ul><li>Справочнике, использующемся в системе, с указанием кода справочника</li><li>Текущей версии справочника в системе</li><li>О новой версии справочника, полученной с веб-сервиса</li></ul><table><tbody><tr><td><p>Код справочника</p></td><td><p>Справочник</p></td><td><p>Текущая версия</p></td><td><p>Доступная версия</p></td></tr><tr><td><p>&nbsp;HST0002</p><p>&nbsp;</p></td><td><p>Справочник типов документов</p></td><td><p>1.0</p></td><td><p>1.1</p></td></tr></tbody></table><p><u style="line-height: 1.4285715;">Задание параметров обновления</u></p><p>Получив информацию о справочниках, которые нужно обновить пользователь должен задать параметр обновления</p><p>Пример: /update: HST0002 (обновить справочник типов документов)</p><p>При этом Пользователь может</p><ul><li>Обновить все справочники, установив значение: 0</li><li>Задать определенный перечень справочников для обновления, указав через запятую коды данных справочников</li></ul><p>По умолчанию: &lt;0&gt; - обновить все справочники</p><p>После того, как был задан параметр обновления, программа формирует запросы к веб-сервису</p><p>long getRefBookParts(String code, String version) &ndash; возвращает количество частей справочника с кодом code, номер версии version.&nbsp; Количество записей в части справочника от 1 до 500.</p><p>После получения количества частей записи формируется новый запрос</p><p>getRefBookPartial (String code, String version, int part) &ndash; возвращает массив записей справочника с кодом code, версии version, части part. Структура записи зависит от справочника.</p><h2>Интеграция с НСИ министерства здравоохранения</h2><p>Интеграция с НСИ министерства здравоохранения осуществляется посредством&nbsp; импорта новых справочников или новых версий уже имеющихся в реестре НСИ справочников посредством REST сервисов.</p><p>Для запуска импорта необходимо запустить соответствующую утилиту из командной строки:</p><ul><li>&gt;externalimport &ndash;source rosmizdrav &nbsp;- возвращает список всех имеющихся справочников</li><li>&gt;externalimport &ndash;source rosmizdrav OID1 OID2 &ndash; Добавляет новый справочник/версию справочника в реестр НСИ. Необходимо указать уникальный идентификатор импортируемого справочника или группы справочников. Для НСИ министерства здравоохранения подобным идентификатором выступает OID справочника.&nbsp;</li></ul><p>Например: &gt;externalimport &ndash;source rosmizdrav 1.2.643.5.1.13.2.1.1.56 (Анатомо-терапевтическо-химическая классификация)</p><p>За раз возможно импортировать не более 10 справочников.&nbsp;При импорте осуществляется сопоставление версий справочников. Если в реестре НСИ есть справочник&nbsp; с более поздней версией, импорт не производится.</p><p><strong style="line-height: 1.4285715;">Просмотр информации о результатах выполнения импорта</strong></p><p>Необходимо выводить в лог следующую информацию:</p><ul><li>о начале работы,</li><li>о завершении работы</li><li>о статусе завершения работы (с ошибками или нет).</li></ul><p><strong style="line-height: 1.4285715;">Обработка исключительных ситуаций:</strong></p><ul><li>Если программа не смогла распознать введенные параметры или параметры введены некорректно, то команда не выполняется.</li><li>&nbsp;Если невозможно к базе данных или невозможно найти в ней нужную таблицу, импорт не производится &nbsp;</li><li>В случае возникновения выше и иных ошибок, они выводятся в лог стандартным для системы способом.</li></ul><p>Интеграция с сервисом НСИ системы здравоохранения реализуется посредством указанных ниже методов:</p><ol><li><strong>getRefbookList</strong><strong> (</strong><strong><em>userKey</em></strong><strong>).</strong>Возвращает список справочников, на которые подписан пользователь. В случае отсутствия информации о подписках возвращается ошибка.</li></ol><p><u>Входные данные :<strong>&nbsp;</strong></u>userKey &ndash; уникальный идентификатор пользователя;</p><p><u>Выходные данные:&nbsp;</u>Многомерный массив / объект типа ArrayOfMap.</p><p><strong>&nbsp;</strong><strong style="line-height: 1.4285715;">2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong><strong style="line-height: 1.4285715;">getVersionList</strong><strong style="line-height: 1.4285715;"> </strong><span style="line-height: 1.4285715;">(</span><em style="line-height: 1.4285715;">userKey</em><em style="line-height: 1.4285715;">,</em><em style="line-height: 1.4285715;">refbookCode</em><span style="line-height: 1.4285715;">). Возвращает список версий выбранного справочника. В случае отсутствия информации о подписке возвращается ошибка.</span></p><p><u>Входные данные:<strong>&nbsp;</strong></u>userKey &ndash; уникальный идентификатор пользователя; refbookCode &ndash; кодовое наименование справочника или его OID;</p><p><u>Выходные данные:&nbsp;</u>Многомерный массив / объект типа ArrayOfMap.</p><p><strong style="line-height: 1.4285715;">3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong><strong style="line-height: 1.4285715;">getRefbook</strong><strong style="line-height: 1.4285715;"> </strong>(<em style="line-height: 1.4285715;">userKey</em><em style="line-height: 1.4285715;">, </em><em style="line-height: 1.4285715;">refbookCode</em><em style="line-height: 1.4285715;">, </em><em style="line-height: 1.4285715;">version</em>). Возвращает выбранную версию справочника. В случае отсутствия версии или отсутствия информации о подписке возвращается ошибка.</p><p><u>Входные данные </u></p><ul><li>userKey &ndash; уникальный идентификатор пользователя;</li><li>refbookCode &ndash; кодовое наименование справочника или его OID;</li><li>version &ndash; номер версии справочника;</li></ul><p><u>Выходные данные:&nbsp;</u>Многомерный массив / объект типа ArrayOfMap.</p><p><strong style="line-height: 1.4285715;">4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong><strong style="line-height: 1.4285715;">getRefbookParts</strong><strong style="line-height: 1.4285715;"> </strong>(<em style="line-height: 1.4285715;">userKey</em><em style="line-height: 1.4285715;">, </em><em style="line-height: 1.4285715;">refbookCode</em><em style="line-height: 1.4285715;">, </em><em style="line-height: 1.4285715;">version</em>). Возвращает число частей выбранной версии справочника. Одна часть содержит 500 записей. В случае отсутствия версии или отсутствия информации о подписке возвращается ошибка.</p><p><u>Входные данные </u></p><ul><li>userKey &ndash; уникальный идентификатор пользователя;</li><li>refbookCode &ndash; кодовое наименование справочника или его OID;</li><li>version &ndash; номер версии справочника;</li></ul><p><u>Выходные данные:&nbsp;</u>Многомерный массив / объект типа ArrayOfMap.<strong style="line-height: 1.4285715;">&nbsp;</strong></p><p><strong style="line-height: 1.4285715;">5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong><strong style="line-height: 1.4285715;">getRefbookPartial </strong><span style="line-height: 1.4285715;">(</span><em style="line-height: 1.4285715;">userKey, refbookCode, version, partNumber</em><span style="line-height: 1.4285715;">). Возвращает указанную часть выбранной версии справочника. В случае некорректного указания части, отсутствия версии или отсутствия информации о подписке возвращается ошибка.</span></p><p><u>Входные данные </u></p><ul><li>userKey &ndash; уникальный идентификатор пользователя;</li><li>refbookCode &ndash; кодовое наименование справочника или его OID;</li><li>version &ndash; номер версии справочника;</li><li>partNumber &ndash; порядковый номер части справочника, начиная с 1;</li></ul><p><u>Выходные данные:&nbsp;</u>Многомерный массив / объект типа ArrayOfMap.</p><p><strong>&nbsp;</strong><strong style="line-height: 1.4285715;">6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong><strong style="line-height: 1.4285715;">getRefbookUpdate </strong><span style="line-height: 1.4285715;">(</span><em style="line-height: 1.4285715;">userKey, refbookCode, userVersion, newVersion</em><span style="line-height: 1.4285715;">).&nbsp; Возвращает изменения между двумя версиями справочника. Если опустить конечную версию, будет использована последняя версия. Если опустить начальную версию, будет использована информация о версии пользователя, сохранённая на сервере. В случае отсутствия изменений или отсутствия информации о подписке возвращается ошибка.</span></p><p><u>Входные данные </u></p><ul><li>userKey &ndash; уникальный идентификатор пользователя;</li><li>refbookCode &ndash; кодовое наименование справочника или его OID;</li><li>userVersion &ndash; начальный номер версии справочника, номер версии пользователя;</li><li>newVersion &ndash; конечный номер версии справочника, последняя версия;</li></ul><p><u>Выходные данные:&nbsp;</u>Многомерный массив / объект типа ArrayOfMap.</p><p class="skipline">&nbsp;</p><p><strong style="line-height: 1.4285715;">Структура упорядоченного </strong><strong style="line-height: 1.4285715;">xml</strong> <strong style="line-height: 1.4285715;">-файла</strong></p><p>&nbsp;</p><p>Существует два варианта структуры xml -файла, получаемого из Реестра НСИ. Для файлов, получаемых в архиве, а также для всех методов сервиса, кроме метода <em>getRefbookList</em> , используется одна общая структура (листинг 1). Отдельные элементы структуры могут присутствовать или отсутствовать в зависимости от вызываемого запроса. Блок с ошибками может присутствовать в любом запросе.</p><p align="right"><strong>Листинг 1</strong> </p><p>&lt;book&gt;</p><p><strong>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Список ошибок --&gt;</strong></p><p>&lt;errors&gt;</p><p>&lt;error code=&quot;<strong>Код ошибки</strong>&quot;&gt;<strong>Текст ошибки</strong>&lt;/error&gt;</p><p>...</p><p>&lt;/errors&gt;</p><p>&nbsp;</p><p><strong>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Информация о справочнике --&gt;</strong></p><p>&lt;properties&gt;</p><p>&lt;name&gt;<strong>Название справочника</strong>&lt;/name&gt;</p><p>&lt;version number=&quot;<strong>Номер версии</strong>&quot; date=&quot;<strong>Дата выхода версии</strong>&quot;/&gt;</p><p>&lt;parts&gt;<strong>Количество частей справочника</strong>&lt;/parts&gt;</p><p>&lt;/properties&gt;</p><p>&nbsp;</p><p><strong>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Список версий --&gt;</strong></p><p>&lt;versions&gt;</p><p>&lt;version number=&quot;<strong>Номер версии</strong>&quot; date=&quot;<strong>Дата выхода версии</strong>&quot;/&gt;</p><p>...</p><p>&lt;/versions&gt;</p><p>&nbsp;</p><p><strong>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- </strong><strong>Записи</strong><strong> --&gt;</strong></p><p>&lt;entries&gt;</p><p>&lt;entry&gt;</p><p><strong>&lt;column1&gt;value1&lt;/column1&gt;</strong></p><p><strong>&lt;column2&gt;value2&lt;/column2&gt;</strong></p><p>...</p><p>&lt;/entry&gt;</p><p>...</p><p>&lt;/entries&gt;</p><p>&lt;/book&gt;</p><p>&nbsp;</p><p>При выгрузке списка справочников методом <em>getRefbookList</em> структура несколько отличается (листинг 2).</p><p align="right"><strong>Листинг 2</strong></p><p>&lt;books&gt;</p><p><strong>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Список ошибок --&gt;</strong></p><p>&lt;errors&gt;</p><p>&lt;error code=&quot;<strong>Код ошибки</strong>&quot;&gt;<strong>Текст ошибки</strong>&lt;/error&gt;</p><p>...</p><p>&lt;/errors&gt;</p><p>&nbsp;</p><p><strong>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Список справочников --&gt;</strong></p><p>&lt;book&gt;</p><p>&lt;code&gt;<strong>Код справочника</strong>&lt;/code&gt;</p><p>&lt;name&gt;<strong>Название справочника</strong>&lt;/name&gt;</p><p>&lt;description&gt;<strong>Описание справочника</strong>&lt;/description&gt;</p><p>&lt;/book&gt;</p><p>...</p><p>&lt;/books&gt;</p><p>&nbsp;</p>