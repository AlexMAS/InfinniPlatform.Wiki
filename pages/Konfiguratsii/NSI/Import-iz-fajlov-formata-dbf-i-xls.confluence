---
layout: default
title: Импорт из файлов формата dbf и xls
position: 
categories: 
tags: 
---

<h1>Описание основного бизнес-процесса</h1><p>&nbsp;В рамках сервиса НСИ предусмотрена процедура&nbsp; добавления (обновления) справочников посредством импорта.&nbsp;При импорте в НСИ создается новый справочник с уникальным идентификатором.Новый справочник создается и в случае импорта новой версии справочника. В этом случает новую версию справочника необходимо относить к определенной группе справочников с одинаковым уникальным идентификатором.&nbsp;</p><p>Наименование справочника, создаваемого в НСИ должно выглядеть следующим образом:&nbsp;&lt;CodeSystem&gt;_&lt;CodeSystemVersion&gt;</p><p>Где</p><p>CodeSystem &ndash; OID справочника (уникальный идентификатор справочника)</p><p>CodeSystemVersion &ndash; Версия справочника.Версию справочника необходимо указывать в формате натуральных чисел с несколькими порядками. Максимальное число порядков &ndash; 4. Например, &nbsp;&laquo;1.0&raquo;, &laquo;1.0.1&raquo;, &nbsp;&laquo;1.0.1.4&raquo; и т.д.</p><p>&nbsp;</p><p>Импорт необходимо осуществлять из файлов следующих форматов:</p><ul><li>&nbsp;Файлы формата dbf</li><li>&nbsp;Файлы формата xls</li></ul><p>Файлы для импорта должны храниться локально.</p><h1>Требования к импортируемому файлу в формате dbf</h1><p>&nbsp;Для импорта файла в формате dbf на него не накладываются никакие требования и ограничения</p><h1>Требования к импортируемому файлу в формате xls</h1><p>&nbsp;Для импорта файла в формате xls на него накладываются следующие требования и ограничения:</p><ul><li>На ячейки не должны быть наложены никакие условия форматирования.</li><li>Данные должны храниться только на 1 листе книги.</li><li>Записи в листе должны начинаться с ячейки A1.</li><li>Порядок столбцов должен строго соответствовать порядку элементов Entry в файле описания метаданных.&nbsp;</li><li>На листе не должно быть сгруппированных ячеек.</li></ul><h1>Требования к описанию метаданных в формате xml</h1><p>Для каждого импортируемого файла необходимо хранить файл&nbsp; с описанием метаданных в формате xml.&nbsp;В файле метаданных содержится общее описание справочника и описание полей справочника.</p><p><strong>&nbsp;</strong></p><p><strong>Общее описание справочника</strong></p><p>Общее описание&nbsp; справочника должно располагаться в корневом элементе Classifier и содержать следующие внутренние элементы:</p><ul><li>*CodeSystem &ndash; OID справочника (уникальный идентификатор справочника). Элемент обязателен.</li><li>*CodeSystemVersion &ndash; Версия справочника. Версию справочника необходимо указывать в формате натуральных чисел с несколькими порядками. Максимальное число порядков &ndash; 4. Например,&nbsp; &laquo;1.0&raquo;, &laquo;1.0.1&raquo;,&nbsp; &laquo;1.0.1.4&raquo; и т.д. Элемент обязателен.</li><li>*CodeSystemName &ndash; Наименование справочника, которое отображается для пользователя. Элемент обязателен.</li><li>*CodeRef &ndash; Наименование ключевого поля (должно соответствовать значению атрибута name одного из внутренних элементов entry). Элемент обязателен.</li><li>*DisplayNameRef &ndash; наименование поля, которое содержит отображаемую информацию. Элемент обязателен.</li><li>ParentRef &ndash; наименование поля, которое выступает в качестве поля-родителя, если справочник поддерживает иерархическую структуру. Значения данного поля должно соответствовать значению ключевого поля, которое является родителем. Элемент не является обязательным</li></ul><p>&nbsp;</p><p><strong>Описание полей справочника.</strong></p><p>Описание полей справочника должно располагаться в элементе Entries&nbsp; корневого элемента Classifier. Каждое поля является внутренним элементом для элемента Entries и носит наименование Entry. Порядок элементов Entry должен соответствовать порядку полей справочника. Для каждого внутреннего элемента (поля справочника) должны быть указаны следующие атрибуты:</p><ul><li>*name &ndash; наименование поля. Элемент обязателен.</li><li>*caption &ndash; наименование поля, которое отображается для пользователя. Элемент обязателен.</li><li>type &ndash; тип данных поля. Допустимые типы данных: date, string, number (пригоден для типов данных float и int), bool. Элемент не является обязательным. Если элемент не указан или имеет &laquo;пустое&raquo; значение, то тип данных по умолчанию &ndash; &laquo;string&raquo;.</li><li>description &ndash; описание поля, если есть такая необходимость, элемент не является обязательным.</li></ul><p>&nbsp;</p><p>Ниже приведен пример описания справочника &laquo;Анатомо-терапевтическо-химическая классификация&raquo; в формате xml.</p><p>Пример:</p><p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p><p>&lt;Classifier&gt;</p><p>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;CodeSystem&gt;atx&lt;/CodeSystem&gt;</p><p>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;CodeSystemVersion&gt;2.2&lt;/CodeSystemVersion&gt;</p><p>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;CodeSystemName&gt;Анатомо-терапевтическо-химическая классификация&lt;/CodeSystemName&gt;</p><p>&nbsp; &lt;CodeRef&gt;recid&lt;/CodeRef&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;DisplayNameRef&gt;name&lt;/DisplayNameRef&gt;</p><p>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ParentRef&gt;high&lt;/ParentRef&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;Description&gt;Международная система классификации лекарственных средств по их основному терапевтическому применению&lt;/Description&gt;</p><p>&nbsp; &lt;Entries&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entry name=&quot;recid&quot; caption=&quot;Уникальный идентификатор&quot; type=&quot;int&quot; description=&quot;&quot;/&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entry name=&quot;code&quot; caption=&quot;Код записи&quot; type=&quot;string&quot; description=&quot;&quot;/&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entry name=&quot;name&quot; caption=&quot;Название лекарственного средства&quot; type=&quot;string&quot; description=&quot;&quot;/&gt;</p><p>&nbsp;&nbsp;&nbsp; &lt;Entry name=&quot;latname&quot; caption=&quot;Латинское название лекарственного средства&quot; type=&quot;string&quot; description=&quot;&quot;/&gt;</p><p>&nbsp;&nbsp;&nbsp; &lt;Entry name=&quot;num&quot; caption=&quot;NUM&quot; type=&quot;string&quot; description=&quot;&quot;/&gt;</p><p>&nbsp;&nbsp;&nbsp; &lt;Entry name=&quot;high&quot; caption=&quot;УИ родительской записи&quot; type=&quot;int&quot; description=&quot;&quot;/&gt;</p><p>&nbsp;&lt;/Entries&gt;</p><p>&lt;/Classifier&gt;<br /> </p><h1>Варианты использования</h1><h2>Импорт из файлов формата xls и dbf</h2><p>Импорт необходимо осуществлять для одного или нескольких справочников в формате xls или dbf.</p><p>Для запуска импорта необходимо запустить соответствующую утилиту, которая позволяет указать путь до импортируемого файла или группы файлов, а также узнать о результатах проведения импорта.</p><p>Для запуска импорта необходимо из командной строки запустить утилиту import:</p><p>&gt;localimport street.dbf street.xml</p><p>Необходимо указать наименования импортируемого файла и наименования файла с описанием метаданных.</p><p>Запускается RESTсервис. Для сервиса необходимо передавать содержимое файлов (xml + dbf или xls) в формате Base64.</p><p>&nbsp;При импорте осуществляется сопоставление версий справочников. Если в реестре НСИ есть справочник&nbsp; с более поздней версией, импорт не производится.</p><p>&nbsp;</p><p>Обработка исключительных ситуаций:</p><ul><li>Если значения обязательных атрибутов не заполнены, или они не соответствуют содержанию файла в формате xls или dbf импорт не производится (например, не заполнен элемент CodeSystemVersion).</li><li>Если невозможно распознать файл-источник как&nbsp; файл dbf или xls, импорт не производится.</li><li>Если невозможно подключиться к базе данных или невозможно найти в ней нужную таблицу, импорт не производится.</li><li>В случае возникновения выше и иных ошибок, они выводятся в лог стандартным для системы способом.</li></ul>