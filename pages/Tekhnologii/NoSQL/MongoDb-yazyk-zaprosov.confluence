---
layout: default
title: MongoDb: язык запросов
position: 0
categories: 
tags: 
---

<p>Производится обзорная характеристика языковых возможностей <a href="http://www.mongodb.org/">MongoDb</a> (на момент описания - версия 2.4).</p><h1>Create</h1><p>Формат команды:</p><ac:structured-macro ac:name="code"><ac:parameter ac:name="language">javascript</ac:parameter><ac:plain-text-body><![CDATA[db.collection.insert( <document> )]]></ac:plain-text-body></ac:structured-macro><table><tbody><tr><th>Операция</th><th>Команда</th></tr><tr><td>Вставка одного документа</td><td><span class="nx">db.collection</span>.insert(&lt;document&gt;)</td></tr><tr><td>Вставка нескольких документов</td><td><span class="nx">db.collection</span>.insert([&nbsp;&lt;document&gt;, ... ])</td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr></tbody></table><h1>Read</h1><p>Формат команды:</p><ac:structured-macro ac:name="code"><ac:parameter ac:name="language">javascript</ac:parameter><ac:plain-text-body><![CDATA[db.collection.find( <query>, <projection> )]]></ac:plain-text-body></ac:structured-macro><p>Если условия выборки <strong>query</strong> не определены, будут возвращены все документы коллекции. Если проекция&nbsp;<strong>projection</strong> не определена, будет возвращено все содержимое документа.</p><p>&nbsp;</p><table><tbody><tr><th>Операция</th><th>Команда</th></tr><tr><td colspan="2"><h4>Операторы</h4></td></tr><tr><td colspan="1">Логическое И</td><td colspan="1"><span class="nx">db.collection</span>.find({&nbsp;&lt;expression&gt;, ... })</td></tr><tr><td colspan="1">Логическое ИЛИ</td><td colspan="1"><p><span class="nx">db.collection</span>.find({&nbsp;<span style="color: rgb(51,153,102);">$or</span>: [ &lt;expression&gt;, ... ] })</p></td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr><tr><td colspan="2"><h4>Выборка по свойствам документа</h4></td></tr><tr><td>Равно</td><td><p><span class="nx">db.collection</span>.find({&nbsp;property: value })</p></td></tr><tr><td>Не равно</td><td><p><span class="nx">db.collection</span>.find({&nbsp;property: { <span style="color: rgb(51,153,102);">$ne</span>: value } })</p></td></tr><tr><td>Меньше</td><td><span class="nx">db.collection</span>.find({ property: { <span style="color: rgb(51,153,102);">$lt</span>: value } })</td></tr><tr><td colspan="1">Меньше или равно</td><td colspan="1"><span class="nx">db.collection</span>.find({ property: { <span style="color: rgb(51,153,102);">$lte</span>: value } })</td></tr><tr><td colspan="1">Больше</td><td colspan="1"><span class="nx">db.collection</span>.find({ property: { <span style="color: rgb(51,153,102);">$gt</span>: value } })</td></tr><tr><td colspan="1">Больше или равно</td><td colspan="1"><span class="nx">db.collection</span>.find({ property: { <span style="color: rgb(51,153,102);">$gte</span>: value } })</td></tr><tr><td colspan="1">Содержит свойство</td><td colspan="1"><span class="nx">db.collection</span>.find({ property: { <span style="color: rgb(51,153,102);">$exists</span>: true } })</td></tr><tr><td colspan="1">Не содержит свойства</td><td colspan="1"><span class="nx">db.collection</span>.find({ property: { <span style="color: rgb(51,153,102);">$exists</span>: false } })</td></tr><tr><td colspan="1">Входит в множество</td><td colspan="1"><span class="nx">db.collection</span>.find({ property: { <span style="color: rgb(51,153,102);">$in</span>: [ &lt;element&gt;, ... ] } })</td></tr><tr><td colspan="1">Выборка по вложенным документам</td><td colspan="1"><span class="nx">db.collection</span>.find({ property:&nbsp;{ &lt;expression by property of subdocument&gt;, ... } })</td></tr><tr><td colspan="1">Выборка по свойству вложенного документа</td><td colspan="1"><span class="nx">db.collection</span>.find({ &lt;expression by 'property.property'&gt; })</td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr><tr><td colspan="2"><h4>Выборка по коллекциям документа</h4></td></tr><tr><td colspan="1">Содержит элемент</td><td colspan="1"><p><span class="nx">db.collection</span>.find({ array: '&lt;element&gt;' })</p></td></tr><tr><td colspan="1">Содержит элемент, удовлетворяющий условию</td><td colspan="1"><span class="nx">db.collection</span>.find({ array:&nbsp;{ $<span class="nx">elemMatch</span>:&nbsp;{&nbsp;&lt;expression&gt;, ... } } })</td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr><tr><td colspan="2"><h4>Проекции документа</h4></td></tr><tr><td colspan="1">Включение определенных свойств в проекцию</td><td colspan="1"><span class="nx">db.collection</span>.find(&lt;expression&gt;, { property1: <span style="color: rgb(51,153,102);">1</span>, property2: <span style="color: rgb(51,153,102);">1</span>, ... })</td></tr><tr><td colspan="1">Исключение определенных свойств из проекции</td><td colspan="1"><span class="nx">db.collection</span>.find(&lt;expression&gt;, { property1: <span style="color: rgb(51,153,102);">0</span>, property2: <span style="color: rgb(51,153,102);">0</span>, ... })</td></tr><tr><td colspan="1">Ограничение выборки для коллекций документа</td><td colspan="1"><span class="nx">db.collection</span>.find(&lt;expression&gt;, { array:&nbsp;{ <span style="color: rgb(51,153,102);">$slice</span>: &lt;number&gt; } })</td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr><tr><td colspan="2"><h4>Работа с курсором</h4></td></tr><tr><td colspan="1">Сортировка по возрастанию</td><td colspan="1"><span class="nx">db.collection</span>.find().<span style="color: rgb(51,153,102);">sort</span>({ property: 1 })</td></tr><tr><td colspan="1">Сортировка по убыванию</td><td colspan="1"><span class="nx">db.collection</span>.find().<span style="color: rgb(51,153,102);">sort</span>({ property: 0 })</td></tr><tr><td colspan="1">Ограничение выборки</td><td colspan="1"><span class="nx">db.collection</span>.find().<span style="color: rgb(51,153,102);">limit</span>(&lt;number&gt;)</td></tr><tr><td colspan="1">Пропуск первых документов</td><td colspan="1"><span class="nx">db.collection</span>.find().<span style="color: rgb(51,153,102);">skip</span>(&lt;number&gt;)</td></tr><tr><td colspan="1">Подсчет количества документов</td><td colspan="1"><span class="nx">db.collection</span>.find().<span style="color: rgb(51,153,102);">count</span>()</td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr></tbody></table><h1>Update</h1><p>Формат команды:</p><ac:structured-macro ac:name="code"><ac:parameter ac:name="language">javascript</ac:parameter><ac:plain-text-body><![CDATA[db.collection.update( <query>, <update>, <options> )]]></ac:plain-text-body></ac:structured-macro><p>По умолчанию метод update() обновляет <strong>один</strong> документ, удовлетворяющий условию выборки <strong>query</strong>; но указав опцию&nbsp;<strong>multi</strong>, можно добиться того, чтобы update() обновлял все документы, которые совпадают с условием.</p><p>&nbsp;</p><table><tbody><tr><th>Операция</th><th>Команда</th></tr><tr><td colspan="2"><h4>Документы</h4></td></tr><tr><td>Заменить документ</td><td><p><span class="nx">db.collection.update(&lt;expression&gt;, &lt;document&gt;)</span></p></td></tr><tr><td colspan="1">Вставить или обновить документ</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;, &lt;document&gt;, { <span style="color: rgb(51,153,102);">upsert</span>: true })</span></td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr><tr><td colspan="2"><h4>Свойства документа</h4></td></tr><tr><td colspan="1">Обновить свойство документа</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,&nbsp;{ <span style="color: rgb(51,153,102);">$set</span>: { property: value } })</span></td></tr><tr><td colspan="1">Обновить свойство вложенного документа</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,<span class="nx">&nbsp;{<span style="color: rgb(51,153,102);">&nbsp;</span></span> <span style="color: rgb(51,153,102);">$set</span>: { 'p<span class="nx">roperty</span>.property': value } })</span></td></tr><tr><td colspan="1">Сделать инкремент свойства документа</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,<span class="nx"><span class="nx">&nbsp;{<span style="color: rgb(51,153,102);">&nbsp;</span></span></span><span style="color: rgb(51,153,102);">$inc</span>: { property: value } })</span></td></tr><tr><td colspan="1">Удалить свойство из документа</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,<span class="nx"><span class="nx">&nbsp;{<span style="color: rgb(51,153,102);">&nbsp;</span></span></span> <span style="color: rgb(51,153,102);">$unset</span>: { p<span class="nx">roperty</span>: 1 } })</span></td></tr><tr><td colspan="1">Переименовать свойство документа</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,<span class="nx"><span class="nx">&nbsp;{<span style="color: rgb(51,153,102);">&nbsp;</span></span></span> <span style="color: rgb(51,153,102);">$<span class="nx">rename</span></span>: { 'old name': 'new name' } })</span></td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr><tr><td colspan="2"><h4>Коллекции документа</h4></td></tr><tr><td colspan="1">Добавить элемент в коллекцию</td><td colspan="1"><span class="nx"><span class="nx">db.collection.update(&lt;expression&gt;, { <span style="color: rgb(51,153,102);">$push</span>: { array: &lt;element&gt; } })</span></span></td></tr><tr><td colspan="1">Добавить элементы в коллекцию</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;, {<span style="color: rgb(51,153,102);"> $<span class="nx"><span class="nx">push</span></span></span>: { array:&nbsp;{ <span style="color: rgb(51,153,102);">$each</span>:&nbsp;[ &lt;element&gt;<span class="nx">&nbsp;</span>, ... ] } } })</span></td></tr><tr><td colspan="1">Добавить элемент в коллекцию, если он там не содержится</td><td colspan="1"><span class="nx"><span class="nx">db.collection.update(&lt;expression&gt;, { <span style="color: rgb(51,153,102);">$</span><span class="nx" style="color: rgb(51,153,102);">addToSet</span>: { array: &lt;element&gt; <span class="nx">&nbsp;</span> } })</span></span></td></tr><tr><td colspan="1">Добавить элементы в коллекцию, если они там не содержатся</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;, { <span style="color: rgb(51,153,102);">$<span class="nx">addToSet</span></span>: { array:&nbsp;{ <span style="color: rgb(51,153,102);">$each</span>:&nbsp;[ &lt;element&gt;<span class="nx">&nbsp;</span>, ... ] } } })</span></td></tr><tr><td colspan="1">Удалить элементы из коллекции по условию</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;, { <span style="color: rgb(51,153,102);">$pull</span>: { array: &lt;expression by <span class="nx">element</span>&gt; } })</span></td></tr><tr><td colspan="1">Удалить первый элемент коллекции</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;, { <span style="color: rgb(51,153,102);">$pop</span>: { array: <span style="color: rgb(51,153,102);">-1</span> } })</span></td></tr><tr><td colspan="1">Удалить последний элемент коллекции</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;, { <span style="color: rgb(51,153,102);">$pop</span>: { array: <span style="color: rgb(51,153,102);">1</span> } })</span></td></tr><tr><td colspan="1">Обновить элемент массива в определенной позиции</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,<span class="nx"><span class="nx">&nbsp;{<span style="color: rgb(51,153,102);">&nbsp;</span></span></span><span style="color: rgb(51,153,102);">$set</span>: { 'array.position': value })</span></td></tr><tr><td colspan="1">Обновить элемент массива без указания позиции</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,<span class="nx"><span class="nx">&nbsp;{<span style="color: rgb(51,153,102);">&nbsp;</span></span></span> <span style="color: rgb(51,153,102);">$</span><span style="color: rgb(51,153,102);">set</span>: { 'array.<span style="color: rgb(51,153,102);">$</span>': value } })</span></td></tr><tr><td colspan="1">Обновить свойство элемента массива в определенной позиции</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,<span class="nx"><span class="nx"> {<span style="color: rgb(51,153,102);">&nbsp;</span></span></span> <span style="color: rgb(51,153,102);">$set</span>: { 'array.position.property': value } })</span></td></tr><tr><td colspan="1">Обновить свойство элемента массива без указания позиции</td><td colspan="1"><span class="nx">db.collection.update(&lt;expression&gt;,&nbsp;{ <span style="color: rgb(51,153,102);">$set</span>: { 'array.<span style="color: rgb(51,153,102);">$</span>.property': value } })</span></td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr></tbody></table><h1>Delete</h1><p>Формат команды:</p><ac:structured-macro ac:name="code"><ac:parameter ac:name="language">javascript</ac:parameter><ac:plain-text-body><![CDATA[db.collection.remove( <query>, <justOne> )]]></ac:plain-text-body></ac:structured-macro><p>Если условия выборки <strong>query</strong> не определены, будут удалены все документы коллекции. Флаг&nbsp;<strong>justOne</strong> по умолчанию равен false, ограничивает количество удаляемых элементов до 1.</p><p>&nbsp;</p><table><tbody><tr><th>Операция</th><th>Команда</th></tr><tr><td>Удалить все документы коллекции</td><td>db.collection.remove()</td></tr><tr><td>Удалить все документы коллекции, удовлетворяющие условию</td><td>db.collection.remove(&lt;expression&gt;)</td></tr><tr><td colspan="1">Удалить первый документ, удовлетворяющий условию</td><td colspan="1">db.collection.remove(&lt;expression&gt;, true)</td></tr><tr><td colspan="1">&nbsp;</td><td colspan="1">&nbsp;</td></tr></tbody></table><p>&nbsp;</p><p>&nbsp;</p>